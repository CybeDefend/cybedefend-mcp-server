// src/tools/getVulnerabilitySca.ts
import axios from "axios";
import { forwardAuth } from "../utils/forwardAuth.js";
const API_BASE = process.env.API_BASE! || "https://api-preprod.cybedefend.com"

export const getVulnerabilityScaTool = {
  name: "get_vulnerability_sca",
  description: "Get details of a single SCA vulnerability.",
  inputSchema: {
    type: "object",
    properties: {
      projectId:      { type: "string" },
      vulnerabilityId:{ type: "string" },
      language:       { type: "string" }
    },
    required: ["projectId","vulnerabilityId"]
  },
  async run({ projectId, vulnerabilityId, language }: any, clientHeaders: Record<string,string|undefined>) {
    const qs = language ? `?language=${encodeURIComponent(language)}` : "";
    const res = await axios.get(
      `${API_BASE}/project/${projectId}/results/sca/${vulnerabilityId}${qs}`,
      { headers: { ...forwardAuth(clientHeaders), "User-Agent": "cybedefend-mcp/1.0" }, timeout: 15_000 }
    );
    return res.data;
  }
};
